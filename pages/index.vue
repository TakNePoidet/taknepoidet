<template>
	<main>
		<div id="home" ref="section-background-images" class="section-background-images jarallax">
			<img class="jarallax-img" src="/images/cover.jpg" alt>
			<div class="section-background-images__content">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 265.465 60">
					<path class="a" d="M0,0H265.465V60H0Z"/>
					<path
						class="b"
						d="M-720-459v-3h259v3Zm23.606-10.434a16.562,16.562,0,0,1-16.552-16.552,16.567,16.567,0,0,1,16.562-16.582A16.567,16.567,0,0,1-679.812-486a16.567,16.567,0,0,1-16.567,16.563Zm-2.058-6.2h4.146v-4.145h-4.146Zm0-6.2h4.146v-14.531h-4.146Zm152.693,6.189a9.847,9.847,0,0,1-2.318-6.854v-.2a10.755,10.755,0,0,1,1.062-4.83,7.756,7.756,0,0,1,2.984-3.3,8.416,8.416,0,0,1,4.418-1.155,7.97,7.97,0,0,1,5.995,2.378,9.351,9.351,0,0,1,2.487,6.307l.017.96a10.847,10.847,0,0,1-1.037,4.823,7.667,7.667,0,0,1-2.968,3.289,8.47,8.47,0,0,1-4.459,1.164q-.163.007-.326.007A7.914,7.914,0,0,1-545.759-475.647Zm2.963-11.468h0a7.969,7.969,0,0,0-1.18,4.765,7.352,7.352,0,0,0,1.164,4.408,3.782,3.782,0,0,0,3.237,1.595,3.743,3.743,0,0,0,3.233-1.622,8.116,8.116,0,0,0,1.155-4.738,7.247,7.247,0,0,0-1.189-4.384,4,4,0,0,0-3.2-1.618h-.017A4.006,4.006,0,0,0-542.8-487.115Zm-43.164,11.586a8.9,8.9,0,0,1-2.42-6.534v-.5a10.947,10.947,0,0,1,1.055-4.882,8.014,8.014,0,0,1,2.958-3.347,7.827,7.827,0,0,1,4.249-1.2,7.161,7.161,0,0,1,5.759,2.378,10.052,10.052,0,0,1,2.032,6.728v1.653h-11.919a5.483,5.483,0,0,0,1.508,3.575,4.528,4.528,0,0,0,3.33,1.315,5.547,5.547,0,0,0,4.587-2.275l2.21,2.108a7.383,7.383,0,0,1-2.927,2.538,9.16,9.16,0,0,1-4.106.9q-.174.007-.347.007A8.481,8.481,0,0,1-585.96-475.529Zm1.777-8.712h7.807v-.3a4.985,4.985,0,0,0-1.1-3.111,3.811,3.811,0,0,0-5.388.128l.005,0A6.118,6.118,0,0,0-584.184-484.241Zm86.567,8.712a8.9,8.9,0,0,1-2.42-6.534v-.5a10.947,10.947,0,0,1,1.055-4.882,8.014,8.014,0,0,1,2.958-3.347,7.825,7.825,0,0,1,4.251-1.2,7.159,7.159,0,0,1,5.758,2.378,10.047,10.047,0,0,1,2.032,6.728v1.653h-11.923a5.48,5.48,0,0,0,1.509,3.575,4.528,4.528,0,0,0,3.33,1.315,5.547,5.547,0,0,0,4.587-2.275l2.209,2.108a7.374,7.374,0,0,1-2.926,2.538,9.163,9.163,0,0,1-4.106.9q-.172.007-.344.007A8.478,8.478,0,0,1-497.616-475.529Zm1.777-8.712h7.807v-.3a4.984,4.984,0,0,0-1.1-3.111,3.81,3.81,0,0,0-5.387.128l0,0A6.118,6.118,0,0,0-495.84-484.241Zm-151.914,9.6-.006-.005a5.019,5.019,0,0,1-1.737-3.879A5.179,5.179,0,0,1-647.33-483a10.492,10.492,0,0,1,6.2-1.56h2.514v-1.2a3.2,3.2,0,0,0-.794-2.268,3.142,3.142,0,0,0-2.41-.85,3.608,3.608,0,0,0-2.293.7,2.166,2.166,0,0,0-.895,1.778h-4.1a4.55,4.55,0,0,1,.995-2.807,6.631,6.631,0,0,1,2.707-2.048,9.5,9.5,0,0,1,3.82-.742,7.654,7.654,0,0,1,5.108,1.611,5.744,5.744,0,0,1,1.957,4.528v8.233a9.31,9.31,0,0,0,.692,3.929v.287h-4.179a6.344,6.344,0,0,1-.472-1.7,6.88,6.88,0,0,1-4.9,2.041A6.873,6.873,0,0,1-647.753-474.64Zm3.507-6.546a2.568,2.568,0,0,0-1.147,2.243,2.394,2.394,0,0,0,.784,1.88,3.036,3.036,0,0,0,2.1.7,4.656,4.656,0,0,0,2.285-.59,3.943,3.943,0,0,0,1.611-1.585v-3.44h-2.21q-.2-.014-.409-.014A6.037,6.037,0,0,0-644.246-481.186Zm131.82,8.109a6.232,6.232,0,0,1-5.189-2.579v0a11.242,11.242,0,0,1-1.981-7.015,10.85,10.85,0,0,1,1.956-6.771A6.267,6.267,0,0,1-512.4-492a5.956,5.956,0,0,1,4.688,2.023v-9.339h4.1v25.9h-3.71l-.2-1.888a6.04,6.04,0,0,1-4.686,2.23Q-512.315-473.073-512.426-473.077Zm4.721-5.582v-7.789a3.809,3.809,0,0,0-3.642-2.191,3.5,3.5,0,0,0-3.074,1.576l0,0a8.453,8.453,0,0,0-1.079,4.747,7.594,7.594,0,0,0,1.071,4.342,3.474,3.474,0,0,0,3.044,1.56A3.869,3.869,0,0,0-507.7-478.659Zm27.938.373v-10.336h-3v-3.037h3v-4.434h4.1v4.434h3.221v3.036h-3.221v10.184a2.246,2.246,0,0,0,.413,1.509,1.912,1.912,0,0,0,1.476.464,6.3,6.3,0,0,0,1.434-.168v3.17a10.075,10.075,0,0,1-2.7.388Q-479.767-473.075-479.767-478.286Zm-47.621,4.874v-18.247h4.1v18.247Zm-41.364-24.556h9.393a9.5,9.5,0,0,1,6.534,2.144,7.209,7.209,0,0,1,2.42,5.673,6.969,6.969,0,0,1-2.369,5.62,9.953,9.953,0,0,1-6.635,2.009h-5.079v9.106l-4.265,0Zm4.265,12.01h5.126a5.051,5.051,0,0,0,3.474-1.071,3.938,3.938,0,0,0,1.2-3.094A4.245,4.245,0,0,0-555.9-493.3a4.675,4.675,0,0,0-3.345-1.224h-5.241Zm-32.106,12.546-10.944-17.42v17.42H-611.8v-24.556h4.266l10.978,17.491v-17.491h4.232v24.556Zm-27.7-7.825-1.823,1.868v5.953h-4.1v-25.9h4.1v14.94l1.282-1.6,5.042-5.684h4.924l-6.779,7.6,7.5,10.641-4.734,0Zm-36.879,7.825v-21.113h-7.589v-3.443h19.477v3.44h-7.658v21.117Zm134.13-21.443a2.122,2.122,0,0,1-.6-1.543,2.174,2.174,0,0,1,.6-1.568,2.261,2.261,0,0,1,1.713-.625,2.291,2.291,0,0,1,1.72.625,2.157,2.157,0,0,1,.607,1.568,2.108,2.108,0,0,1-.607,1.543,2.308,2.308,0,0,1-1.72.617q-.075,0-.149,0A2.278,2.278,0,0,1-527.046-494.854ZM-720-510v-3h259v3Z"
						transform="translate(723 516)"
					/>
				</svg>
			</div>
			<svg x="0px" y="0px" viewBox="0 0 1501 78" class="section-background-images__bottom">
				<path d="M0,78,296.48,9.221l829.27,61.094L1501,0V78Z"/>
			</svg>
		</div>
		<div id="about" class="section-about">
			<h2 class="section-title">{{ $store.state.lang.header.about_me }}</h2>
			<div>
				<p v-html="$store.state.lang.section.about.text"/>
			</div>
		</div>

		<div id="social" class="section-social-networks social_networks">
			<svg
				xmlns="http://www.w3.org/2000/svg"
				viewBox="0 0 1501 32.167"
				class="section-social-networks__top"
			>
				<path
					d="M835,117.166c-330.106,0-615.469-7.71-751-18.9V85H1585V98.348C1449.065,109.494,1164.29,117.166,835,117.166Z"
					transform="translate(-84 -85)"
				/>
			</svg>
			<h2 class="section-title">{{ $store.state.lang.section.social.title }}</h2>
			<ul class="social_networks__links">
				<li
					v-for="(item, key) in social_networks"
					:key="item.key"
					:class="['wow', ((key & 1) ? 'bounceInUp' : 'bounceInDown'),'social_networks__item', 'social_networks__item--' + item.key]"
					:data-wow-delay="key / 10 + 's'"
				>
					<a :href="item.link" target="_blank">
						<div class="social_networks__item__logo">
							<i :class="item.icon"/>
						</div>
						<div class="social_networks__item__nik">{{ item.nik }}</div>
						<div class="social_networks__item__name">{{ item.name }}</div>
					</a>
				</li>
			</ul>
			<svg
				xmlns="http://www.w3.org/2000/svg"
				viewBox="0 0 1501 32.167"
				class="section-social-networks__bottom"
			>
				<path
					d="M835,85c-330.107,0-615.469,7.71-751,18.9v13.266H1585V103.818C1449.065,92.672,1164.29,85,835,85Z"
					transform="translate(-84 -85)"
				/>
			</svg>
		</div>
		<div id="news" class="section-news">
			<h2 class="section-title">{{ $store.state.lang.section.news.title }}</h2>
			<div v-if="news.length > 1" ref="news" class="news">
				<news-min v-for="item in news" :key="item.id" :data="item" />
			</div>
			<div v-if="news.length < 1" class="news__none"/>
		</div>

		<div id="landing-list" class="section-landing">
			<svg
				class="section-landing-svg-top"
				xmlns="http://www.w3.org/2000/svg"
				viewBox="0 0 1501 52.166"
			>
				<path d="M106.969,52.418h0V.253h1501l-1501,52.165Z" transform="translate(-106.969 -0.253)"/>
			</svg>
			<h2 class="section-title">{{ $store.state.lang.section.landing_list.title }}</h2>

			<div class="landing-crop">
				<div class="landing-crop__wrap">
					<div v-for="(item) in rand_landing()" :key="item.key" class="landing-crop-item wow zoomIn">
						<a :href="item.link" target="_blank" rel="nofollow">
							<div class="landing-crop-item__images">
								<img
									:src="`${$store.state.storage}/images/landing/crop/${item.filename}@1x.jpg`"
									:alt="item.title[getLocale]"
									:srcset="`${$store.state.storage}/images/landing/crop/${item.filename}@2x.jpg 2x`"
								>
							</div>
							<div class="landing-crop-item__title">{{ item.title[getLocale] }}</div>
						</a>
					</div>
				</div>

				<a
					href="/landing"
					target="blank"
					class="landing-crop-all"
				>{{ $store.state.lang.section.landing_list.more }}</a>
			</div>
			<svg
				class="section-landing-svg-bottom"
				xmlns="http://www.w3.org/2000/svg"
				viewBox="0 0 1501 52.166"
			>
				<path
					d="M106.969,52.418h0V.253h1501l-1501,52.165Z"
					transform="translate(1607.969 52.418) rotate(180)"
				/>
			</svg>
		</div>
		<div id="project" class="project">
			<h2 class="section-title">{{ $store.state.lang.section.project.title }}</h2>
			<div class="project__wrap">
				<div v-for="item of project" :key="item.link" class="project__item wow flipInX">
					<a :href="item.link" target="_blank">
						<div class="project__images">
							<img
								:src="`${$store.state.storage}/images/projects/${item.images}.jpg`"
								:srcset="`${$store.state.storage}/images/projects/${item.images}@2x.jpg 2x`"
							>
						</div>
						<div class="project__name">{{ item.title[getLocale] }}</div>
					</a>
				</div>
			</div>
			<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1501.37 30.818">
				<g transform="translate(5277.37 6670)">
					<path d="M0,30.64H0V0H1501L0,30.64Z" transform="translate(-3776 -6639.36) rotate(180)"/>
					<path
						d="M106.969.253h0V30.906H1608.339L106.969.253Z"
						transform="translate(-5384.339 -6670.087)"
					/>
				</g>
			</svg>
		</div>
	</main>
</template>

<script>
// import SwipeSlider from '~/plugins/SwipeSlider.js'
import { mapActions, mapGetters } from 'vuex'
import axios from 'axios'
import NewsMin from '~/components/news-min.vue'

export default {
	components: {
		NewsMin
	},
	head() {
		return {
			title: this.title,
			meta: [
				{
					name: 'viewport',
					content:
						'width=device-width, initial-scale=1, shrink-to-fit=no'
				},
				{
					hid: 'description',
					name: 'description',
					content: this.description
				}
			]
		}
	},
	layout: 'main',
	async asyncData({ params, store }) {
		let { data } = await axios.get(`${store.state.api}methods/all`)
		let news = data.news
		let social_networks = data.social_networks
		let landing = data.landing
		let project = data.project

		let title = store.state.lang.page.index.title
		let description = store.state.lang.page.index.description

		return {
			news,
			social_networks,
			project,
			landing,
			title,
			description
		}
	},
	data() {
		return {
			news: [],
			social_networks: [],
			project: [],
			landing: [],
			description: '',
			title: ''
		}
	},
	computed: {
		...mapGetters(['getHeader', 'getLocale'])
	},

	mounted() {
		if (process.browser && navigator.appVersion.indexOf('MSIE 10') === -1) {
			import('jarallax').then(Response => {
				let jarallax = Response.default.jarallax
				jarallax(this.$refs['section-background-images'], {
					speed: 0
				})
			})

			// let SwipeSlider = require('~/plugins/SwipeSlider.js')
			// console.log(SwipeSlider())
			// import('~/plugins/SwipeSlider.js').then(Response => {
			// 	// let SwipeSlider = Response.default.SwipeSlider
			// 	console.log(Response)
			// })
			// let news_block = this.$refs['news']
			// let news_block_items = Array.from(
			// 	news_block.querySelectorAll('.news__item')
			// )
		}
	},
	created() {
		if (process.browser) {
			window.addEventListener('scroll', this.windowScroll)
		}
	},
	beforeDestroy() {
		if (process.browser) {
			window.removeEventListener('scroll', this.windowScroll)
		}
	},

	methods: {
		windowScroll() {
			let box = this.$refs['section-background-images']
			let { height } = box.getBoundingClientRect()
			let scrollTop = window.pageYOffset

			box.querySelector(
				'.section-background-images__content'
			).style.opacity = scrollTop === 0 ? 1 : 1 / ((scrollTop / 100) * 4)

			if (scrollTop > height - 90 * 2) {
				this.getHeader.fixed = true
			} else {
				this.getHeader.fixed = false
				this.getHeader.open = false
			}
		},

		rand_landing() {
			if (process.browser) {
				let landing = this.landing.slice()

				landing = landing.filter(el => {
					return el.top === true
				})

				let rand_landing = landing.sort(function(a, b) {
					return Math.random() - 0.5
				})
				return rand_landing.slice(0, 6)
			}
		}
	}
}
</script>
